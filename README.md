# GreatVideoEditor
Видеоредактор для работы на микроконтроллерах. Редактируйте видео прямо на вашей пердуине или Влиппере Зеро!

# Основные функции:
1. Чтение файлов mp4 (никаких AVI или MKV, но может быть ts)
2. Сохранение файлов
3. Изменение времени (константно, кривая времени)
4. Добавление (append) на таймлайн элементов по времени
5. Добавление (append) элементов по номеру семпла (номер кадра, пакет звука)
6. Замещение элементов (добавление с заменой, удаление) куска таймлайна по времени/семплу
7. Смещение таймлайна (в том числе после удаления)
8. Работа как со всей композицией в целом (звук и видео), так и с отдельными потоками.

Графический интерфейс будет выполнен с использованием библиотеки UltraGUI (расчитана на поддержку интерфейсов до 256х256 пикселей, 1 бит, оптимизирована под экраны 128х64 пикселя, 1 бит).

# Программный интерфейс:
**ВОРК ИН ПРОГРЕСС ХЕРЕ**

Этот интерфейс должен вмещать в себя всю вселенную видеоредактирования, что позволило бы реализовать свой видеоредактор с самыми смелыми желаниями и амбициями. Я слабо представляю, что я тут делаю, но как-то так:

Я кажется придумал красивое и элегантное определение видеоредактора.

Видеоредактор - это средство для расположения аудио/видеосемплов во времени и пространстве.

Если следовать такому определению, то написать видеоредактор совсем просто:

// Открывает медиафайл по имени и возвращает некий хендл.
```
MEDIAFILE *open_file(char *filename);
```
Честно говоря, не знаю пока что именно возвращает, неплохо было бы распарсить файл целиком и получить индекс семплов, но это может быть большая структура. Допустим, у нас 3 часа видео, то получаем:

```
3*60*60 = 10800 секунд
10800*30 fps = 324000 графических семплов (пакетов)
10800*44100*2/1024 = 930234 звуковых семплов (пакетов)
Если использовать по 16 байт на семпл, как сделано в AVI, то получаем
(930234+324000)*16 = 20067744
```
20 мегабайт на 3 часа, что как-то дохуя для мобильного видеоредактора. С другой стороны, распарсив файлы в начале и получив индекс, можно получить 100% абстракцию и парсить любую неинтерливную медию, т.е. avi/mp4 без разницы.

Далее получаем сегмент(ы) нашей медии:
```
SEGMENT *media_get_segment_by_time(MEDIAFILE* file, float offset, float length);
SEGMENT *media_get_segment_by_sample(MEDIAFILE* file, int offset, int length);
SEGMENT **media_get_segments_by_optical_flow(MEDIAFILE* file); // нарезать видео на сегменты по оптическому потоку
```
Ну и редактируем сколько пожелаем:
```
void seg_set_fps(SEGMENT *seg, int nom, int denom);
void seg_set_duration(SEGMENT *seg, float duration);
void seg_set_time_curve(SEGMENT *seg, CURVE **curves); // пока не придумал как
void seg_set_screen_position(SEGMENT *seg, POINT *screen_offset);
```
Так и расставляем их на таймлайне:
```
void media_append(MEDIAFILE *out, SEGMENT *seg);
void media_set_segment(MEDIAFILE *out, SEGMENT *seg, int offset, int length);
```

# ВСЕ, ВЕСЬ РЕДАКТОР ГОТОВ. НОВЫХ ФУНКЦИЙ УЖЕ НЕ ПРИДУМАТЬ.

Разве что до кучи добавить наложение текста, но для этого надо добавить что-то вроде:
```
SEGMENT *new_text_sample(char *text, float time, float duration);
```
И вот тут проблема: получившийся сегмент будет содержать в себе только текст, но не аудио и видео. С другой стороны, выше мы оперируем именно "медией" в целом, т.е. не задрачиваемся на составляющие видео/звука. А текст сам по себе. Т.е. у нас непроизвольно смешивается высокоуровневое определение сегмента видео, как некоторой единицы со звуком и видео, так и низкоуровневое, где есть только отдельные потоки медиаданных. И я хз как это увязать между собой.

Все, я высрался, всем спасибо. Могу идти дальше спать.

По идее, этого должно хватить для захвата вселенной и всего такого.

Этот репозиторий создан для того, чтобы высрать говно из моего мозга в ваш, пожаловаться самому себе и для отладки при помощи уточки. Но вы можете срать в ищьюз тоже, если вам интересен принципиально новый видеоредактор или вы заинтересованы, чтобы я таки выложил записи с синичками.
